<div class="flex justify-between items-center px-6 py-4">
  <h1 class="text-xl font-semibold text-gray-800">Security</h1>
  <a href="/" class="text-red-500 font-medium">Logout</a>
</div>

<div class="px-6 space-y-4">

  <a href="#" class="block bg-white shadow rounded-lg p-4">
    <p class="font-semibold text-gray-700">Manage Users</p>
  </a>

  <a href="#" class="block bg-white shadow rounded-lg p-4">
    <p class="font-semibold text-gray-700">View Logs</p>
  </a>

  <div class="block bg-white shadow rounded-lg p-4">
    <p class="font-semibold text-gray-700 mb-2">My Roles & Permissions</p>
    <ul class="text-sm text-gray-600 space-y-1">
      <li><span class="font-medium">Auth Level:</span> <span id="sec_auth_role">...</span></li>
      <li><span class="font-medium">User ID:</span> <span id="sec_user_id" class="font-mono text-xs">...</span></li>
      <li><span class="font-medium">App Role:</span> <span id="sec_app_role">...</span></li>
      <li><span class="font-medium">Matchmaker:</span> <span id="sec_mm_role">...</span></li>
    </ul>
  </div>

  <a href="#" class="block bg-white shadow rounded-lg p-4">
    <p class="font-semibold text-gray-700">System Status</p>
  </a>

</div>

<script type="module">
  import { supabase } from "./src/supabase.js";

  async function loadSecurityRoles() {
    const authEl = document.getElementById("sec_auth_role");
    const idEl = document.getElementById("sec_user_id");
    const appEl = document.getElementById("sec_app_role");
    const mmEl = document.getElementById("sec_mm_role");

    if (!authEl) return;

    const { data: { session } } = await supabase.auth.getSession();
    
    if (!session) {
      authEl.textContent = "Guest (Anon)";
      if (idEl) idEl.textContent = "-";
      appEl.textContent = "-";
      mmEl.textContent = "-";
      return;
    }

    authEl.textContent = session.user.role; // 'authenticated'
    if (idEl) idEl.textContent = session.user.id;

    // Check App Role
    const { data: person } = await supabase
      .schema("cabo")
      .from("mm_people")
      .select("role")
      .eq("id", session.user.id)
      .maybeSingle();
    
    appEl.textContent = person?.role || "None";

    // Check Matchmaker
    const { data: mm } = await supabase
      .schema("cabo")
      .from("mm_matchmakers")
      .select("id")
      .eq("auth_user_id", session.user.id)
      .maybeSingle();

    mmEl.textContent = mm ? "Yes" : "No";
  }

  loadSecurityRoles();
</script>